<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>indexedDB</title>
</head>
<body>
	<script type="text/javascript">
		// window.indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB;
		/* 
		 DON'T use "var indexedDB = ..." if you're not in a function.
		 Moreover, you may need references to some window.IDB* objects:
		 */
		// window.IDBTransaction = window.IDBTransaction || window.webkitIDBTransaction || window.msIDBTransaction;
		// window.IDBKeyRange = window.IDBKeyRange || window.webkitIDBKeyRange || window.msIDBKeyRange
		// (Mozilla has never prefixed these objects, so we don't need window.mozIDB*)
		if (!window.indexedDB) {
		    window.alert("Your browser doesn't support a stable version of IndexedDB. Such and such feature will not be available.")
		}
		const customerData = [
		  { ssn: "444-44-4444", name: "Bill", age: 35, email: "bill@company.com" },
		  { ssn: "555-55-5555", name: "Donna", age: 32, email: "donna@home.org" },
		  { ssn: "666-66-6666", name: "Bill", age: 35, email: "bill666@company.com" },
		  { ssn: "777-77-7777", name: "Bill", age: 35, email: "bill777@company.com" },
		  { ssn: "888-888-888", name: "Bill", age: 35, email: "bill888@company.com" }
		];
		const dbName = "the_name";
		
		/*

		// 打开我们的数据库
		var request = window.indexedDB.open("MyTestDatabase", 2);
		request.onerror = function(event) {
			console.error("error:", event);
		}
		request.onsuccess = function(event) {
			console.log("success:", event);
			var db = event.target.result;
			
		}
		// 该事件仅在较新的浏览器中实现了
		request.onupgradeneeded = function(event) {
			console.log("onupgradeneeded:", event)
		  	// 保存 IDBDataBase 接口
		  	var db = event.target.result;
		  	db.onerror = function(event) {
			  alert("Database error: " + event.target.errorCode);
			};

		  // 为该数据库创建一个对象仓库
		  var objectStore = db.createObjectStore("name", { keyPath: "myKey" });
		};




		// 我们的客户数据看起来像这样。
		const customerData = [
		  { ssn: "444-44-4444", name: "Bill", age: 35, email: "bill@company.com" },
		  { ssn: "555-55-5555", name: "Donna", age: 32, email: "donna@home.org" },
		  { ssn: "666-66-6666", name: "Bill", age: 35, email: "bill666@company.com" },
		  { ssn: "777-77-7777", name: "Bill", age: 35, email: "bill777@company.com" }
		];


		const dbName = "the_name";
		var request2 = indexedDB.open(dbName, 2);

		request2.onerror = function(event) {
		  // 错误处理
		  console.log("error:",event);
		};
		request2.onupgradeneeded = function(event) {
			console.log("onupgradeneeded:", event);
			var db2 = event.target.result;

			// 建立一个对象仓库来存储我们客户的相关信息，我们选择 ssn 作为键路径（key path）
			// 因为 ssn 可以保证是不重复的
			// var objectStore1 = db2.createObjectStore("customers", { keyPath: "ssn" });

			// 建立一个索引来通过姓名来搜索客户。名字可能会重复，所以我们不能使用 unique 索引
			// objectStore1.createIndex("name", "name", { unique: false });

			// 使用邮箱建立索引，我们向确保客户的邮箱不会重复，所以我们使用 unique 索引
			// objectStore1.createIndex("email", "email", { unique: true });

			// 使用事务的 oncomplete 事件确保在插入数据前对象仓库已经创建完毕
			// objectStore1.transaction.oncomplete = function(event) {
			    // 将数据保存到新创建的对象仓库
			  //   var customerObjectStore = db2.transaction("customers", "readwrite").objectStore("customers");
			  //   customerData.forEach(function(customer) {
			  //     customerObjectStore.add(customer);
			  //   });
		  	// };
		  	// var customerObjectStore2 = db2.transaction("customers", "readwrite").objectStore("customers");
		   //  customerData.forEach(function(customer) {
		   //    customerObjectStore2.add(customer);
		   //  });
		};
		request2.onsuccess = function (event) {
			console.log("success:", event);
			var db2 = event.target.result;
			var customerObjectStore = db2.transaction("customers", "readwrite").objectStore("customers");
		    customerData.forEach(function(customer) {
		      customerObjectStore.add(customer);
		    });
		}

*/

		// 打开 indexedDB.
		// var request3 = indexedDB.open(dbName, 3);

		// request3.onupgradeneeded = function (event) {
		//     var db = event.target.result;
		//     // 设置 autoIncrement 标志为 true 来创建一个名为 names 的对象仓库  
		//     // var objStore = db.createObjectStore("customers", { autoIncrement : true });
		//     var objStore = db.transaction("customers", "readwrite").objectStore("customers", { autoIncrement : true });

		//     // 因为 names 对象仓库拥有键生成器，所以它的键会自动生成。
		//     // 被插入的数据可以表示如下：
		//     // key : 1 => value : "Bill"
		//     // key : 2 => value : "Donna"
		//     customerData.forEach(function(customer) {
		//         objStore.add(customer);
		//     });
		// };


	</script>
</body>
</html>